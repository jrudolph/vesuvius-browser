@import net.virtualvoid.vesuvius._

@(infos: Seq[ImageInfo], layerThumbnails: Seq[LayerDefinition])

@for((scroll, infos) <- infos.groupBy(_.ref.scrollRef).toVector.sortBy(x => (if (x._1.base.productPrefix.contains("Fragment")) 1 else 0, scala.util.Try(x._1.scrollId.toInt).getOrElse(Int.MaxValue), x._1.scrollId))) {

<h3>Scroll @scroll.scrollId / @scroll.newScrollId.name</h3>

<table>
    <tr>
        <th>Scroll</th><th>Volume</th><th>Scan Resolution</th><th>Segment</th><th>Area / cm²</th><th>Width</th><th>Height</th>
        @for(
            layer <- layerThumbnails
        ) {
            <th><a href="@layer.url">@layer.longName</a></th>
        }
        <th>Mask</th>
    </tr>

@for(info <- infos.sortBy(_.segmentId).reverse) {
    <tr>
        <td>@scroll.newScrollId.name</td>
        @for(volumeMeta <- info.volumeMetadata) {
            <td>@volumeMeta.uuid</td>
            <td>@{volumeMeta.voxelsize}μm</td>
        }
        @if(info.volumeMetadata.isEmpty) {
            <td colspan="2"></td>
        }
        <td><a href="/scroll/@info.scrollId/segment/@info.segmentId/">@info.segmentId</a></td>
        <td>@{info.area.map(_.formatted("%5.2f")).getOrElse("")}</td>
        <td>@info.width</td>
        <td>@info.height</td>
        @for(layer <- layerThumbnails) {
            <td><a href="/scroll/@info.scrollId/segment/@info.segmentId/#layer=@{layer.name}"><img src="/scroll/@info.scrollId/segment/@info.segmentId/inferred/@layer.name"/></a></td>
        }
        <td><img src="/scroll/@info.scrollId/segment/@info.segmentId/mask"/></td>
    </tr>
}
</table>
}
